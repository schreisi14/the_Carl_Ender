<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Bootstrap 101 Template</title>

  <!-- Bootstrap -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
  <script id="task-template2" type="text/x-handlebars-template">
    {{user}}
  </script>

  <script id="task-template" type="text/x-handlebars-template">
    <div>
    {{#each task}}
    <div class="col-md-4">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">{{local.name}}</h3>
        </div>
        <div class="panel-body">
          <ul class="list-group">
            <li class="list-group-item">{{dataFormat local.date}} - {{local.time}}</li>
            <li class="list-group-item">{{local.place}}</li>
          </ul>
          <p>
            {{local.text}} <br>
            id: {{_id}}
          </p>
        </div>
        <div id="panel">
          <div class="panel-footer text-right">
            <span>
              Zusagen: 10
            </span>
            <span>
              Absagen: 3
            </span>
          </div>
        </div>
      </div>
    </div>
    {{/each}}
  </div>
</script>


  {{>nav}}


    <button type="button" name="button" onclick="handleAjax()">AJAX</button>
  <div class="content-placeholder" id="test">
    DAAAAA

  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/handlebars.min-latest.js"></script>





<script type="text/javascript">
    function handleAjax(){
      var tofill = document.getElementById('test');

      var xhttp = new XMLHttpRequest();

      xhttp.onreadystatechange = function(){
        if (xhttp.readyState == 4 & xhttp.status == 200) {
          var dbget = JSON.parse(xhttp.responseText);
          console.log("dbget: " + [dbget]);
          //var dbget = xhttp.responseText;
          console.log(document.getElementById('test').innerHTML);
          //Get the Template from above
        var Source = document.getElementById("task-template2").text;
        console.log("SRC: " + Source);
        //Compile the actual Template file
        var Template = Handlebars.compile(Source);

        //Generate some HTML code from the compiled Template
        var HTML = Template({ user : dbget[0].local.text });

        //Replace the body section with the new code.
        document.body.innerHTML = HTML;

          // var source   = document.getElementById("task-template").innerHTML;
          // var template = Handlebars.compile(source);
          // console.log(template(dbget));
          // document.getElementsByClassName("content-placeholder").InnerHTML = template(dbget);

        }
      }
      xhttp.open('GET','/task', true);

      xhttp.send();
    }
</script>


</body>
</html>
